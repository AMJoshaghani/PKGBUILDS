#!/bin/bash

echo2() { echo "$@" >&2 ; }
msg()   { echo2 "==>" "$@" ; }

Main() {
    local conf=/etc/eos-rankmirrors.conf
    source $conf || return

    local timeout="$EOS_AUTORANK_TIMEOUT"
    [ -n "$timeout" ] || timeout=30

    if [ "$EOS_AUTO_MIRROR_RANKING" = "yes" ] ; then
        if eos-rankmirrors --timeout $timeout --save-as-pacnew >/dev/null ; then
            local mlfile=/etc/pacman.d/endeavouros-mirrorlist
            msg "A ranked new EndeavourOS mirror list was saved into $mlfile.pacnew."
            msg "To use it,"
            msg "   1. copy it to $mlfile (or use 'eos-pacdiff')"
            msg "   2. run: 'sudo pacman -Syu'"
        fi
    else
        msg "Configured in $conf not to do mirror ranking."
    fi
}

Main "$@"
